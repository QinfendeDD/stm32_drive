#include "SPWM.h"
#include "led.h"
#include "usart.h"


u16 TimerPeriod =1024;//对应2^12=4095 TIM的计算，如果是3600，则是更大,为2^13
u16 DutyFactor = 50;


void TIM34_Int_Init(void)
{
	  GPIO_InitTypeDef GPIO_InitStructure;
    TIM_TimeBaseInitTypeDef  TIM_TimeBaseStructure;
	  NVIC_InitTypeDef NVIC_InitStructure;

	 RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOC| RCC_APB2Periph_AFIO, ENABLE);        
   RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM4 | RCC_APB1Periph_TIM3,ENABLE);            //时钟使能

 //Timer3部分重映射  TIM3_CH1->PB4   //用于TIM3的CH2输出的PWM通过该LED显示
//		GPIO_PinRemapConfig(GPIO_PartialRemap_TIM3, ENABLE); //Timer3部分重映射  TIM3_CH2->PB5部分重映射时PB4没有输出，暂时没有找到冲突引脚                                                                      	 //用于TIM3的CH2输出的PWM通过该LED显示

	GPIO_PinRemapConfig(GPIO_FullRemap_TIM3, ENABLE); //Timer3完全重映射  TIM3_CH1->PC6 TIM3_CH2->PC7                                                                       	 //用于TIM3的CH2输出的PWM通过该LED显示
	
	
	          /* GPIOC配置:通道PC.6和PC.7作为输出引脚*/
         GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6 | GPIO_Pin_7| GPIO_Pin_8;
         GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;
         GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
         GPIO_Init(GPIOC, &GPIO_InitStructure);
	
         TIM_TimeBaseStructure.TIM_Prescaler = 0;
         TIM_TimeBaseStructure.TIM_CounterMode = TIM_CounterMode_Up;                //计数方式
         TIM_TimeBaseStructure.TIM_Period = 4000;
         TIM_TimeBaseStructure.TIM_ClockDivision = 0;
         TIM_TimeBaseStructure.TIM_RepetitionCounter = 0;
         TIM_TimeBaseInit(TIM3, &TIM_TimeBaseStructure);
         
         TIM_DeInit(TIM4);                //这边是普通定时器的初始化和中断申请
         TIM_TimeBaseStructure.TIM_Period=2004;    //自动重装载寄存器的值
         TIM_TimeBaseStructure.TIM_Prescaler=1;   //时钟预分频数
         TIM_TimeBaseStructure.TIM_ClockDivision=TIM_CKD_DIV1; //采样分频
         TIM_TimeBaseStructure.TIM_CounterMode=TIM_CounterMode_Up;//计数方式
         TIM_TimeBaseInit(TIM4, &TIM_TimeBaseStructure);
         TIM_ClearFlag(TIM4, TIM_FLAG_Update); //清除溢出中断标志
         TIM_ITConfig(TIM4,TIM_IT_Update,ENABLE);  // 计数溢出时触发中断  
//根据NVIC_InitStruct中指定的参数初始化外设NVIC寄存器

         NVIC_PriorityGroupConfig(NVIC_PriorityGroup_0);
         NVIC_InitStructure.NVIC_IRQChannel = TIM4_IRQn; //通道TIM3
         NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0;//占优先级
         NVIC_InitStructure.NVIC_IRQChannelSubPriority = 1; //副优先级
         NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
         NVIC_Init(&NVIC_InitStructure);
 		 
}

static vu16 sign = 0;
 static vu16 Counter_sine=0; 
static vu16 Duty_Cycle_sinewavetable1[360]=
{
2008,2043,2077,2112,2146,2181,2215,2249,2284,2318,2352,2386,2420,2453,2487,2520,
2554,2587,2620,2652,2685,2717,2749,2781,2813,2844,2875,2906,2937,2967,2997,3027,
3056,3085,3114,3142,3170,3198,3225,3252,3279,3305,3331,3356,3381,3406,3430,3453,
3477,3499,3522,3544,3565,3586,3606,3626,3646,3665,3683,3701,3719,3735,3752,3768,
3783,3798,3812,3825,3839,3851,3863,3874,3885,3895,3905,3914,3923,3931,3938,3945,
3951,3956,3961,3966,3970,3973,3975,3977,3979,3979,3979,3979,3978,3976,3974,3971,
3968,3964,3959,3954,3948,3941,3934,3927,3919,3910,3900,3890,3880,3869,3857,3845,
3832,3819,3805,3790,3775,3760,3744,3727,3710,3692,3674,3655,3636,3616,3596,3576,
3554,3533,3511,3488,3465,3442,3418,3393,3369,3344,3318,3292,3266,3239,3212,3184,
3156,3128,3100,3071,3041,3012,2982,2952,2921,2891,2860,2828,2797,2765,2733,2701,
2669,2636,2603,2570,2537,2504,2470,2436,2403,2369,2335,2301,2267,2232,2198,2163,
2129,2094,2060,2025,1991,1956,1922,1887,1853,1818,1784,1750,1715,1681,1647,1613,
1579,1546,1512,1479,1445,1412,1379,1347,1314,1282,1250,1218,1186,1155,1124,1093,
1062,1032,1002,972,943,914,885,857,829,801,774,747,720,694,668,643,
618,593,569,546,522,500,477,455,434,413,393,373,353,334,316,298,
280,264,247,231,216,201,187,174,160,148,136,125,114,104,94,85,
76,68,61,54,48,43,38,33,29,26,24,22,20,20,20,20,
21,23,25,28,31,35,40,45,51,58,65,72,80,89,99,109,
119,130,142,154,167,180,194,209,224,239,255,272,289,307,325,344,
363,383,403,423,445,466,488,511,534,557,581,606,630,655,681,707,
733,760,787,815,843,871,899,928,958,987,1017,1047,1078,1108,1139,1171,
1202,1234,1266,1298,1330,1363,1396,1429,1462,1495,1529,1563,1596,1630,1664,1698,
1732,1767,1801,1836,1870,1905,1939,1974
};
static vu16 Duty_Cycle_sinewavetable2[128]=
{
0x03BB,0x03AD,0x039F,0x0390,0x0380,0x036F,0x035D,0x034B,0x0337,0x0323,
0x030E,0x02F8,0x02E2,0x02CB,0x02B4,0x029C,0x0284,0x026C,0x0253,0x023A,
0x0221,0x0208,0x01EF,0x01D6,0x01BD,0x01A5,0x018C,0x0174,0x015C,0x0144,
0x012D,0x0117,0x0100,0x00EB,0x00D6,0x00C2,0x00AF,0x009D,0x008B,0x007A,
0x006B,0x005C,0x004E,0x0041,0x0036,0x002B,0x0022,0x0019,0x0012,0x000D,
0x0008,0x0004,0x0002,0x0001,0x0001,0x0003,0x0005,0x0009,0x000E,0x0015,
0x001C,0x0025,0x002F,0x0039,0x0045,0x0053,0x0061,0x0070,0x0080,0x0091,
0x00A3,0x00B5,0x00C9,0x00DD,0x00F2,0x0108,0x011E,0x0135,0x014C,0x0164,
0x017C,0x0194,0x01AD,0x01C6,0x01DF,0x01F8,0x0211,0x022A,0x0243,0x025B,
0x0274,0x028C,0x02A4,0x02BC,0x02D3,0x02E9,0x0300,0x0315,0x032A,0x033E,
0x0351,0x0363,0x0375,0x0386,0x0395,0x03A4,0x03B2,0x03BF,0x03CA,0x03D5,
0x03DE,0x03E7,0x03EE,0x03F3,0x03F8,0x03FC,0x03FE,0x03FF,0x03FF,0x03FD,
0x03FB,0x03F7,0x03F2,0x03EB,0x03E4,0x03DB,0x03D1,0x03C7
};
static vu16 Duty_Cycle_sinewavetable3[128]=
{
0x0045,0x0039,0x002F,0x0025,0x001C,0x0015,0x000E,0x0009,0x0005,0x0003,
0x0001,0x0001,0x0002,0x0004,0x0008,0x000D,0x0012,0x0019,0x0022,0x002B,
0x0036,0x0041,0x004E,0x005C,0x006B,0x007A,0x008B,0x009D,0x00AF,0x00C2,
0x00D6,0x00EB,0x0101,0x0117,0x012D,0x0144,0x015C,0x0174,0x018C,0x01A5,
0x01BD,0x01D6,0x01EF,0x0208,0x0221,0x023A,0x0253,0x026C,0x0284,0x029C,
0x02B4,0x02CB,0x02E2,0x02F8,0x030E,0x0323,0x0337,0x034B,0x035D,0x036F,
0x0380,0x0390,0x039F,0x03AD,0x03BB,0x03C7,0x03D1,0x03DB,0x03E4,0x03EB,
0x03F2,0x03F7,0x03FB,0x03FD,0x03FF,0x03FF,0x03FE,0x03FC,0x03F8,0x03F3,
0x03EE,0x03E7,0x03DE,0x03D5,0x03CA,0x03BF,0x03B2,0x03A4,0x0395,0x0386,
0x0375,0x0363,0x0351,0x033E,0x032A,0x0315,0x02FF,0x02E9,0x02D3,0x02BC,
0x02A4,0x028C,0x0274,0x025B,0x0243,0x022A,0x0211,0x01F8,0x01DF,0x01C6,
0x01AD,0x0194,0x017C,0x0164,0x014C,0x0135,0x011E,0x0108,0x00F2,0x00DD,
0x00C9,0x00B5,0x00A3,0x0091,0x0080,0x0070,0x0061,0x0053
};
// static vu16 Duty_Cycle_sinewavetable1[256]={
//0x0200,0x020D,0x0219,0x0226,0x0232,0x023F,0x024B,0x0257,0x0264,0x0270,
//0x027C,0x0288,0x0294,0x02A0,0x02AC,0x02B8,0x02C4,0x02CF,0x02DA,0x02E6,
//0x02F1,0x02FC,0x0307,0x0311,0x031C,0x0326,0x0330,0x033A,0x0344,0x034E,
//0x0357,0x0360,0x0369,0x0372,0x037B,0x0383,0x038B,0x0393,0x039A,0x03A2,
//0x03A9,0x03B0,0x03B6,0x03BD,0x03C3,0x03C8,0x03CE,0x03D3,0x03D8,0x03DD,
//0x03E1,0x03E5,0x03E9,0x03EC,0x03F0,0x03F3,0x03F5,0x03F7,0x03F9,0x03FB,
//0x03FD,0x03FE,0x03FE,0x03FF,0x03FF,0x03FF,0x03FE,0x03FE,0x03FD,0x03FB,
//0x03F9,0x03F7,0x03F5,0x03F3,0x03F0,0x03EC,0x03E9,0x03E5,0x03E1,0x03DD,
//0x03D8,0x03D3,0x03CE,0x03C8,0x03C3,0x03BD,0x03B6,0x03B0,0x03A9,0x03A2,
//0x039A,0x0393,0x038B,0x0383,0x037B,0x0372,0x0369,0x0360,0x0357,0x034E,
//0x0344,0x033A,0x0330,0x0326,0x031C,0x0311,0x0307,0x02FC,0x02F1,0x02E6,
//0x02DA,0x02CF,0x02C4,0x02B8,0x02AC,0x02A0,0x0294,0x0288,0x027C,0x0270,
//0x0264,0x0257,0x024B,0x023F,0x0232,0x0226,0x0219,0x020D,0x0200,0x01F3,
//0x01E7,0x01DA,0x01CE,0x01C1,0x01B5,0x01A9,0x019C,0x0190,0x0184,0x0178,
//0x016C,0x0160,0x0154,0x0148,0x013C,0x0131,0x0126,0x011A,0x010F,0x0104,
//0x00F9,0x00EF,0x00E4,0x00DA,0x00D0,0x00C6,0x00BC,0x00B2,0x00A9,0x00A0,
//0x0097,0x008E,0x0085,0x007D,0x0075,0x006D,0x0066,0x005E,0x0057,0x0050,
//0x004A,0x0043,0x003D,0x0038,0x0032,0x002D,0x0028,0x0023,0x001F,0x001B,
//0x0017,0x0014,0x0010,0x000D,0x000B,0x0009,0x0007,0x0005,0x0003,0x0002,
//0x0002,0x0001,0x0001,0x0001,0x0002,0x0002,0x0003,0x0005,0x0007,0x0009,
//0x000B,0x000D,0x0010,0x0014,0x0017,0x001B,0x001F,0x0023,0x0028,0x002D,
//0x0032,0x0038,0x003D,0x0043,0x004A,0x0050,0x0057,0x005E,0x0066,0x006D,
//0x0075,0x007D,0x0085,0x008E,0x0097,0x00A0,0x00A9,0x00B2,0x00BC,0x00C6,
//0x00D0,0x00DA,0x00E4,0x00EF,0x00F9,0x0104,0x010F,0x011A,0x0126,0x0131,
//0x013C,0x0148,0x0154,0x0160,0x016C,0x0178,0x0184,0x0190,0x019C,0x01A9,
//0x01B5,0x01C1,0x01CE,0x01DA,0x01E7,0x01F3};
// static vu16 Duty_Cycle_sinewavetable2[256]={
//0x03BB,0x03B4,0x03AD,0x03A7,0x039F,0x0398,0x0390,0x0388,0x0380,0x0378,
//0x036F,0x0366,0x035D,0x0354,0x034B,0x0341,0x0337,0x032D,0x0323,0x0318,
//0x030E,0x0303,0x02F8,0x02ED,0x02E2,0x02D7,0x02CB,0x02C0,0x02B4,0x02A8,
//0x029C,0x0290,0x0284,0x0278,0x026C,0x0260,0x0253,0x0247,0x023A,0x022E,
//0x0221,0x0215,0x0208,0x01FC,0x01EF,0x01E3,0x01D6,0x01CA,0x01BD,0x01B1,
//0x01A5,0x0198,0x018C,0x0180,0x0174,0x0168,0x015C,0x0150,0x0144,0x0139,
//0x012D,0x0122,0x0117,0x010B,0x0100,0x00F6,0x00EB,0x00E1,0x00D6,0x00CC,
//0x00C2,0x00B9,0x00AF,0x00A6,0x009D,0x0094,0x008B,0x0083,0x007A,0x0072,
//0x006B,0x0063,0x005C,0x0055,0x004E,0x0048,0x0041,0x003B,0x0036,0x0030,
//0x002B,0x0026,0x0022,0x001D,0x0019,0x0016,0x0012,0x000F,0x000D,0x000A,
//0x0008,0x0006,0x0004,0x0003,0x0002,0x0001,0x0001,0x0001,0x0001,0x0002,
//0x0003,0x0004,0x0005,0x0007,0x0009,0x000C,0x000E,0x0011,0x0015,0x0018,
//0x001C,0x0020,0x0025,0x002A,0x002F,0x0034,0x0039,0x003F,0x0045,0x004C,
//0x0053,0x0059,0x0061,0x0068,0x0070,0x0078,0x0080,0x0088,0x0091,0x009A,
//0x00A3,0x00AC,0x00B5,0x00BF,0x00C9,0x00D3,0x00DD,0x00E8,0x00F2,0x00FD,
//0x0108,0x0113,0x011E,0x0129,0x0135,0x0140,0x014C,0x0158,0x0164,0x0170,
//0x017C,0x0188,0x0194,0x01A0,0x01AD,0x01B9,0x01C6,0x01D2,0x01DF,0x01EB,
//0x01F8,0x0204,0x0211,0x021D,0x022A,0x0236,0x0243,0x024F,0x025B,0x0268,
//0x0274,0x0280,0x028C,0x0298,0x02A4,0x02B0,0x02BC,0x02C7,0x02D3,0x02DE,
//0x02E9,0x02F5,0x0300,0x030A,0x0315,0x031F,0x032A,0x0334,0x033E,0x0347,
//0x0351,0x035A,0x0363,0x036C,0x0375,0x037D,0x0386,0x038E,0x0395,0x039D,
//0x03A4,0x03AB,0x03B2,0x03B8,0x03BF,0x03C5,0x03CA,0x03D0,0x03D5,0x03DA,
//0x03DE,0x03E3,0x03E7,0x03EA,0x03EE,0x03F1,0x03F3,0x03F6,0x03F8,0x03FA,
//0x03FC,0x03FD,0x03FE,0x03FF,0x03FF,0x03FF,0x03FF,0x03FE,0x03FD,0x03FC,
//0x03FB,0x03F9,0x03F7,0x03F4,0x03F2,0x03EF,0x03EB,0x03E8,0x03E4,0x03E0,
//0x03DB,0x03D6,0x03D1,0x03CC,0x03C7,0x03C1};
// static vu16 Duty_Cycle_sinewavetable3[256]={
//0x0045,0x003F,0x0039,0x0034,0x002F,0x002A,0x0025,0x0020,0x001C,0x0018,
//0x0015,0x0011,0x000E,0x000C,0x0009,0x0007,0x0005,0x0004,0x0003,0x0002,
//0x0001,0x0001,0x0001,0x0001,0x0002,0x0003,0x0004,0x0006,0x0008,0x000A,
//0x000D,0x000F,0x0012,0x0016,0x0019,0x001D,0x0022,0x0026,0x002B,0x0030,
//0x0036,0x003B,0x0041,0x0048,0x004E,0x0055,0x005C,0x0063,0x006B,0x0072,
//0x007A,0x0083,0x008B,0x0094,0x009D,0x00A6,0x00AF,0x00B9,0x00C2,0x00CC,
//0x00D6,0x00E1,0x00EB,0x00F6,0x0101,0x010B,0x0117,0x0122,0x012D,0x0139,
//0x0144,0x0150,0x015C,0x0168,0x0174,0x0180,0x018C,0x0198,0x01A5,0x01B1,
//0x01BD,0x01CA,0x01D6,0x01E3,0x01EF,0x01FC,0x0208,0x0215,0x0221,0x022E,
//0x023A,0x0247,0x0253,0x0260,0x026C,0x0278,0x0284,0x0290,0x029C,0x02A8,
//0x02B4,0x02C0,0x02CB,0x02D7,0x02E2,0x02ED,0x02F8,0x0303,0x030E,0x0318,
//0x0323,0x032D,0x0337,0x0341,0x034B,0x0354,0x035D,0x0366,0x036F,0x0378,
//0x0380,0x0388,0x0390,0x0398,0x039F,0x03A7,0x03AD,0x03B4,0x03BB,0x03C1,
//0x03C7,0x03CC,0x03D1,0x03D6,0x03DB,0x03E0,0x03E4,0x03E8,0x03EB,0x03EF,
//0x03F2,0x03F4,0x03F7,0x03F9,0x03FB,0x03FC,0x03FD,0x03FE,0x03FF,0x03FF,
//0x03FF,0x03FF,0x03FE,0x03FD,0x03FC,0x03FA,0x03F8,0x03F6,0x03F3,0x03F1,
//0x03EE,0x03EA,0x03E7,0x03E3,0x03DE,0x03DA,0x03D5,0x03D0,0x03CA,0x03C5,
//0x03BF,0x03B8,0x03B2,0x03AB,0x03A4,0x039D,0x0395,0x038E,0x0386,0x037D,
//0x0375,0x036C,0x0363,0x035A,0x0351,0x0347,0x033E,0x0334,0x032A,0x031F,
//0x0315,0x030A,0x02FF,0x02F5,0x02E9,0x02DE,0x02D3,0x02C7,0x02BC,0x02B0,
//0x02A4,0x0298,0x028C,0x0280,0x0274,0x0268,0x025B,0x024F,0x0243,0x0236,
//0x022A,0x021D,0x0211,0x0204,0x01F8,0x01EB,0x01DF,0x01D2,0x01C6,0x01B9,
//0x01AD,0x01A0,0x0194,0x0188,0x017C,0x0170,0x0164,0x0158,0x014C,0x0140,
//0x0135,0x0129,0x011E,0x0113,0x0108,0x00FD,0x00F2,0x00E8,0x00DD,0x00D3,
//0x00C9,0x00BF,0x00B5,0x00AC,0x00A3,0x009A,0x0091,0x0088,0x0080,0x0078,
//0x0070,0x0068,0x0061,0x0059,0x0053,0x004C};

//定时器4中断服务程序
void TIM4_IRQHandler(void)
{
 static u16 s1 = 0;
 static u16 s2 = 120;
 static u16 s3 = 240;
 if (TIM_GetITStatus(TIM4 ,TIM_IT_Update) == SET) 
 {
	  TIM_ClearITPendingBit(TIM4 , TIM_FLAG_Update);
	  TIM3->CCR1  = (u32)Duty_Cycle_sinewavetable1[s1];
		TIM3->CCR2  = (u32)Duty_Cycle_sinewavetable1[s2];
		TIM3->CCR3  = (u32)Duty_Cycle_sinewavetable1[s3];
//				TIM4->CCR1  = (u32)Sine_Table_1[A_phase];
//				TIM4->CCR2  = (u32)Sine_Table_2[B_phase];
//				TIM4->CCR3  = (u32)Sine_Table_3[C_phase];
				if(s1>358)  s1=0;
		    if(s2>358)  s2=0;
		    if(s3>358)  s3=0;
				s1++;
				s2++;
				s3++;
//  if(sign == 0)
//  {
//         TIM_SetCompare3(TIM3,Duty_Cycle_sinewavetable[Counter_sine]);
//         TIM_SetCompare2(TIM3,Duty_Cycle_sinewavetable[Counter_sine]);
//         TIM_SetCompare1(TIM3,Duty_Cycle_sinewavetable[Counter_sine]);
//		
//         Counter_sine++;
//         if(Counter_sine==100)  //半周期采样100个点
//         {
//              Counter_sine=0;
//              sign = 1;
//         }
//  }
//	else if(sign==1)
//		{
//         TIM_SetCompare3(TIM3,Duty_Cycle_sinewavetable[Counter_sine]);
//         TIM_SetCompare2(TIM3,Duty_Cycle_sinewavetable[Counter_sine]);
//			   TIM_SetCompare1(TIM3,Duty_Cycle_sinewavetable[Counter_sine]);
//         Counter_sine++;
//         if(Counter_sine==100)
//         {
//              Counter_sine=0;
//              sign = 2;  
//         }
//   }
//		else if(sign==2)
//		{
//         TIM_SetCompare3(TIM3,Duty_Cycle_sinewavetable[Counter_sine]);
//			   TIM_SetCompare2(TIM3,Duty_Cycle_sinewavetable[Counter_sine]);
//         TIM_SetCompare1(TIM3,Duty_Cycle_sinewavetable[Counter_sine]);
//         Counter_sine++;
//         if(Counter_sine==100)
//         {
//              Counter_sine=0;
//              sign = 0;  
//         }
//   }
 }
}



//TIM3 PWM部分初始化 
//PWM输出初始化
//arr：自动重装值
//psc：时钟预分频数
void TIM3_PWM_Init(void)
{  
	
	      TIM_OCInitTypeDef  TIM_OCInitStructure;
	      TIM_BDTRInitTypeDef TIM_BDTRInitStructure;
	

	       TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;
         TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;
         TIM_OCInitStructure.TIM_OutputNState = TIM_OutputNState_Enable;
         TIM_OCInitStructure.TIM_Pulse = DutyFactor *2813 / 100;//设置占空比
         TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_High;//以上四行代码设置PWM的空闲电平、波形方式的！
	
	       TIM_OCInitStructure.TIM_OCNPolarity = TIM_OCNPolarity_High; 
         TIM_OCInitStructure.TIM_OCIdleState = TIM_OCIdleState_Set;
         TIM_OCInitStructure.TIM_OCNIdleState = TIM_OCIdleState_Reset;
         TIM_OC3Init(TIM3, &TIM_OCInitStructure);	       
         TIM_OC1Init(TIM3, &TIM_OCInitStructure);
         TIM_OC2Init(TIM3, &TIM_OCInitStructure);                        //初始化两组互补的PWM 
         /* 自动输出使能,中断,死区相关的设置*/  
         TIM_BDTRInitStructure.TIM_OSSRState = TIM_OSSRState_Enable;
         TIM_BDTRInitStructure.TIM_OSSIState = TIM_OSSIState_Enable;
         TIM_BDTRInitStructure.TIM_LOCKLevel = TIM_LOCKLevel_1;
         TIM_BDTRInitStructure.TIM_DeadTime = 12;//死区时间为 12/SYSTEMCLK (ns)
         TIM_BDTRInitStructure.TIM_Break = TIM_Break_Disable;//关闭外部break功能
         TIM_BDTRInitStructure.TIM_BreakPolarity = TIM_BreakPolarity_High;
         TIM_BDTRInitStructure.TIM_AutomaticOutput = TIM_AutomaticOutput_Enable;
         TIM_BDTRConfig(TIM3, &TIM_BDTRInitStructure);
         TIM_CtrlPWMOutputs(TIM3, ENABLE); 


}




